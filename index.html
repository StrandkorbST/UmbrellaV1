<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal Architect - Smart Goal System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0a0a0f;
            --surface: #12121a;
            --surface-elevated: #1a1a25;
            --surface-hover: #22222f;
            --border: #2a2a3a;
            --border-subtle: #1f1f2e;
            --text: #f0f0f5;
            --text-secondary: #8a8a9a;
            --text-muted: #5a5a6a;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --success: #10b981;
            --success-dim: #059669;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.4);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* Navigation */
        .nav {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .nav-links {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .nav-link:hover {
            background: var(--surface-hover);
            color: var(--text);
        }

        .nav-link.active {
            background: var(--surface-elevated);
            color: var(--accent);
            border-color: var(--border);
        }

        /* Main Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Header Section */
        .header-section {
            margin-bottom: 32px;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: var(--transition);
        }

        .stat-card:hover {
            border-color: var(--border-subtle);
            transform: translateY(-2px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            background: var(--surface-elevated);
        }

        .stat-icon.success { background: rgba(16, 185, 129, 0.1); }
        .stat-icon.warning { background: rgba(245, 158, 11, 0.1); }
        .stat-icon.info { background: rgba(59, 130, 246, 0.1); }
        .stat-icon.accent { background: rgba(99, 102, 241, 0.1); }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1;
        }

        /* Controls Bar */
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--surface-hover);
            border-color: var(--border-subtle);
        }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        .btn-secondary {
            background: transparent;
        }

        .btn-icon {
            padding: 8px;
            width: 36px;
            height: 36px;
            justify-content: center;
        }

        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            gap: 4px;
            background: var(--surface);
            padding: 4px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            width: fit-content;
        }

        .filter-tab {
            padding: 6px 16px;
            border-radius: var(--radius-sm);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-tab:hover {
            color: var(--text);
        }

        .filter-tab.active {
            background: var(--surface-elevated);
            color: var(--text);
            box-shadow: var(--shadow);
        }

        /* Goal Tree */
        .goal-tree {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .goal-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
        }

        .goal-card:hover {
            border-color: var(--border-subtle);
            box-shadow: var(--shadow);
        }

        .goal-card[data-level="0"] { border-left: 3px solid var(--accent); }
        .goal-card[data-level="1"] { border-left: 3px solid #8b5cf6; }
        .goal-card[data-level="2"] { border-left: 3px solid #ec4899; }
        .goal-card[data-level="3"] { border-left: 3px solid #f59e0b; }

        .goal-header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .goal-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-subtle);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .goal-checkbox:hover {
            border-color: var(--accent);
        }

        .goal-checkbox.completed {
            background: var(--success);
            border-color: var(--success);
        }

        .goal-checkbox.completed::after {
            content: "✓";
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .goal-expand {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 0.75rem;
            flex-shrink: 0;
        }

        .goal-expand:hover {
            background: var(--surface-hover);
            color: var(--text);
        }

        .goal-expand.expanded {
            transform: rotate(90deg);
        }

        .goal-expand.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .goal-type-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            flex-shrink: 0;
        }

        .badge-progress { background: rgba(99, 102, 241, 0.1); color: #818cf8; }
        .badge-recurring { background: rgba(59, 130, 246, 0.1); color: #60a5fa; }
        .badge-distance { background: rgba(245, 158, 11, 0.1); color: #fbbf24; }
        .badge-stage { background: rgba(139, 92, 246, 0.1); color: #a78bfa; }

        .goal-title-input {
            flex: 1;
            min-width: 0;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 1rem;
            font-weight: 500;
            padding: 8px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .goal-title-input:focus {
            outline: none;
            background: var(--surface-hover);
        }

        .goal-title-input.completed {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .goal-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* Progress Displays */
        .progress-bar-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-bar {
            width: 120px;
            height: 6px;
            background: var(--surface-elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-fill.completed {
            background: var(--success);
        }

        .progress-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
            min-width: 40px;
        }

        /* Streak Display */
        .streak-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--surface-elevated);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .streak-icon {
            font-size: 1rem;
        }

        /* Distance Meter */
        .distance-meter {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .distance-track {
            width: 140px;
            height: 8px;
            background: var(--surface-elevated);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .distance-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .distance-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255,255,255,0.3);
        }

        .distance-value {
            font-size: 0.875rem;
            font-weight: 600;
            min-width: 50px;
        }

        /* Stage Pipeline */
        .stage-pipeline {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .stage-pill {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 500;
            background: var(--surface-elevated);
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .stage-pill.active {
            background: var(--accent);
            color: white;
        }

        .stage-pill.completed {
            background: var(--success-dim);
            color: white;
        }

        .stage-arrow {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* Health Indicator */
        .health-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 600;
            background: var(--surface-elevated);
        }

        .health-high { color: var(--success); }
        .health-medium { color: var(--warning); }
        .health-low { color: var(--danger); }

        /* Deadline */
        .deadline-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8125rem;
            background: var(--surface-elevated);
            color: var(--text-secondary);
        }

        .deadline-badge.urgent {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .deadline-badge.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        /* Action Buttons */
        .goal-actions {
            display: flex;
            gap: 4px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 0.875rem;
        }

        .action-btn:hover {
            background: var(--surface-hover);
            color: var(--text);
        }

        .action-btn.success:hover { color: var(--success); background: rgba(16, 185, 129, 0.1); }
        .action-btn.danger:hover { color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        .action-btn.primary:hover { color: var(--accent); background: rgba(99, 102, 241, 0.1); }

        /* Children Container */
        .children-container {
            border-top: 1px solid var(--border);
            background: rgba(0,0,0,0.2);
        }

        .children-wrapper {
            padding: 16px 20px 16px 56px;
            display: none;
        }

        .children-wrapper.expanded {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .add-sub-goal {
            margin-top: 12px;
            padding: 12px;
            width: 100%;
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-sub-goal:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(99, 102, 241, 0.05);
        }

        /* Distance Actions */
        .distance-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .distance-btn {
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface-elevated);
            color: var(--text-secondary);
            font-size: 0.8125rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .distance-btn:hover {
            border-color: var(--accent);
            color: var(--text);
        }

        .distance-btn.positive {
            border-color: var(--success-dim);
            color: var(--success);
        }

        .distance-btn.positive:hover {
            background: rgba(16, 185, 129, 0.1);
        }

        .distance-btn.negative {
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }

        .distance-btn.negative:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: var(--surface);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 1px solid var(--border);
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .empty-text {
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 24px 24px 0;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 0 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg);
            color: var(--text);
            font-size: 0.9375rem;
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Type Selector */
        .type-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .type-card {
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
        }

        .type-card:hover {
            border-color: var(--border-subtle);
            background: var(--surface-hover);
        }

        .type-card.selected {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.05);
        }

        .type-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 12px;
            background: var(--surface-elevated);
        }

        .type-card.selected .type-icon {
            background: var(--accent);
        }

        .type-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.9375rem;
        }

        .type-desc {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Conditional Options */
        .conditional-options {
            display: none;
            animation: slideDown 0.3s ease;
            padding: 20px;
            background: var(--surface-elevated);
            border-radius: var(--radius);
            margin-top: 16px;
        }

        .conditional-options.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .goal-header {
                flex-wrap: wrap;
            }
            
            .goal-meta {
                width: 100%;
                margin-top: 12px;
                padding-left: 40px;
            }
            
            .children-wrapper {
                padding-left: 24px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-subtle);
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">◈</div>
                <span>Goal Architect</span>
            </a>
            <div class="nav-links">
                <a href="index.html" class="nav-link active">Goals</a>
                <a href="birthdays.html" class="nav-link">Birthdays</a>
                <a href="contacts.html" class="nav-link">Contacts</a>
                <a href="bookmarks.html" class="nav-link">Bookmarks</a>
                <a href="phd-tracker.html" class="nav-link">PhD Tracker</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header-section">
            <h1 class="header-title">Goal Dashboard</h1>
            <p class="header-subtitle">Track progress, maintain streaks, and achieve your objectives</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon accent">◈</div>
                    <div class="stat-label">Total Goals</div>
                </div>
                <div class="stat-value" id="totalGoals">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon success">✓</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-value" id="completedGoals">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon info">●</div>
                    <div class="stat-label">Health Score</div>
                </div>
                <div class="stat-value" id="avgHealth">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon warning">⚡</div>
                    <div class="stat-label">Active Streaks</div>
                </div>
                <div class="stat-value" id="activeStreaks">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon info">◷</div>
                    <div class="stat-label">Due Soon</div>
                </div>
                <div class="stat-value" id="dueSoon">0</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="openModal()">
                <span>+</span> New Goal
            </button>
            <button class="btn btn-secondary" onclick="exportData()">
                Export
            </button>
            <button class="btn btn-secondary" onclick="importData()">
                Import
            </button>
            
            <div style="flex: 1;"></div>
            
            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterGoals('all')">All</button>
                <button class="filter-tab" onclick="filterGoals('active')">Active</button>
                <button class="filter-tab" onclick="filterGoals('completed')">Completed</button>
            </div>
        </div>

        <div class="goal-tree" id="goalTree">
            <div class="empty-state">
                <div class="empty-icon">◈</div>
                <div class="empty-title">No goals yet</div>
                <p class="empty-text">Create your first goal to start tracking progress. You can set up different types: simple progress, recurring habits, distance tracking, or stage-based milestones.</p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modal" onclick="if(event.target === this) closeModal()">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create New Goal</h3>
                <p class="modal-subtitle">Choose a goal type and configure your tracking</p>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Goal Type</label>
                    <div class="type-grid">
                        <div class="type-card selected" data-type="progress" onclick="selectType(this)">
                            <div class="type-icon">◈</div>
                            <div class="type-name">Progress</div>
                            <div class="type-desc">Classic progress bar with sub-tasks and percentage completion</div>
                        </div>
                        <div class="type-card" data-type="recurring" onclick="selectType(this)">
                            <div class="type-icon">↻</div>
                            <div class="type-name">Recurring</div>
                            <div class="type-desc">Daily/weekly habits with streak tracking and success rates</div>
                        </div>
                        <div class="type-card" data-type="distance" onclick="selectType(this)">
                            <div class="type-icon">→</div>
                            <div class="type-name">Distance</div>
                            <div class="type-desc">Move between 0-100% with customizable forward/backward events</div>
                        </div>
                        <div class="type-card" data-type="stage" onclick="selectType(this)">
                            <div class="type-icon">◎</div>
                            <div class="type-name">Stages</div>
                            <div class="type-desc">Pipeline stages: move step-by-step through defined phases</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Goal Title</label>
                    <input type="text" class="form-input" id="goalTitle" placeholder="What do you want to achieve?">
                </div>

                <!-- Recurring Options -->
                <div class="conditional-options" id="recurringOptions">
                    <div class="form-group">
                        <label class="form-label">Frequency</label>
                        <select class="form-select" id="recurringInterval">
                            <option value="day">Daily</option>
                            <option value="week" selected>Weekly</option>
                            <option value="month">Monthly</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Times per interval</label>
                        <input type="number" class="form-input" id="recurringTimes" value="3" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Required success rate (%)</label>
                        <input type="number" class="form-input" id="recurringRequired" value="80" min="1" max="100">
                    </div>
                </div>

                <!-- Distance Options -->
                <div class="conditional-options" id="distanceOptions">
                    <div class="form-group">
                        <label class="form-label">Starting position (0-100%)</label>
                        <input type="number" class="form-input" id="distanceStart" value="0" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Forward events (+value)</label>
                        <textarea class="form-textarea" id="distanceWins" placeholder="Milestone reached: +20&#10;Good progress: +10"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Backward events (-value)</label>
                        <textarea class="form-textarea" id="distanceLosses" placeholder="Setback occurred: -15&#10;Delay: -10"></textarea>
                    </div>
                </div>

                <!-- Stage Options -->
                <div class="conditional-options" id="stageOptions">
                    <div class="form-group">
                        <label class="form-label">Stage names (comma separated)</label>
                        <textarea class="form-textarea" id="stageNames">Research, Planning, Execution, Review, Complete</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Current stage</label>
                        <select class="form-select" id="stageCurrent">
                            <option value="0">Research (Start)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Deadline (optional)</label>
                    <input type="date" class="form-input" id="goalDeadline">
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveGoal()">Create Goal</button>
            </div>
        </div>
    </div>

    <script>
        // Data Management
        let goals = JSON.parse(localStorage.getItem('goal_architect_goals')) || [];
        let currentParentId = null;
        let selectedType = 'progress';
        let currentFilter = 'all';
        let nextId = Math.max(0, ...goals.map(g => g.id)) + 1;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderGoals();
            updateStats();
            
            // Stage dropdown listener
            const stageInput = document.getElementById('stageNames');
            if (stageInput) {
                stageInput.addEventListener('input', updateStageDropdown);
            }
        });

        function generateId() { return nextId++; }

        function saveData() {
            localStorage.setItem('goal_architect_goals', JSON.stringify(goals));
        }

        // Modal Functions
        function openModal(parentId = null) {
            currentParentId = parentId;
            document.getElementById('modal').classList.add('active');
            document.getElementById('goalTitle').value = '';
            document.getElementById('goalTitle').focus();
            // Reset type to progress
            selectType(document.querySelector('.type-card[data-type="progress"]'));
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            currentParentId = null;
        }

        function selectType(element) {
            document.querySelectorAll('.type-card').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedType = element.dataset.type;
            
            // Toggle conditional options
            document.getElementById('recurringOptions').classList.toggle('active', selectedType === 'recurring');
            document.getElementById('distanceOptions').classList.toggle('active', selectedType === 'distance');
            document.getElementById('stageOptions').classList.toggle('active', selectedType === 'stage');
            
            if (selectedType === 'stage') {
                updateStageDropdown.call(document.getElementById('stageNames'));
            }
        }

        function updateStageDropdown() {
            const stages = this.value.split(',').map(s => s.trim()).filter(s => s);
            const select = document.getElementById('stageCurrent');
            select.innerHTML = stages.map((s, i) => 
                `<option value="${i}">${escapeHtml(s)} ${i === 0 ? '(Start)' : i === stages.length - 1 ? '(End)' : ''}</option>`
            ).join('');
        }

        // Goal Creation
        function createGoal(title, parentId = null, config = {}) {
            const base = {
                id: generateId(),
                title: title || 'New Goal',
                type: config.type || 'progress',
                completed: false,
                expanded: true,
                parentId: parentId,
                deadline: config.deadline || null,
                createdAt: new Date().toISOString(),
                children: []
            };

            switch(config.type) {
                case 'recurring':
                    return {
                        ...base,
                        recurring: {
                            interval: config.interval || 'week',
                            timesPerInterval: config.timesPerInterval || 3,
                            requiredPercent: config.requiredPercent || 80,
                            completions: [],
                            streak: 0,
                            bestStreak: 0
                        },
                        health: 100
                    };

                case 'distance':
                    return {
                        ...base,
                        distance: {
                            current: config.distanceStart || 0,
                            history: [{date: new Date().toISOString(), value: config.distanceStart || 0, reason: 'Start'}],
                            winEvents: parseEvents(config.wins || ''),
                            lossEvents: parseEvents(config.losses || '')
                        }
                    };

                case 'stage':
                    const stages = (config.stages || 'Start,In Progress,Complete').split(',').map(s => s.trim()).filter(s => s);
                    return {
                        ...base,
                        stage: {
                            stages: stages,
                            currentIndex: Math.min(config.currentStage || 0, stages.length - 1),
                            history: [{date: new Date().toISOString(), from: null, to: Math.min(config.currentStage || 0, stages.length - 1)}]
                        }
                    };

                default:
                    return base;
            }
        }

        function parseEvents(text) {
            const events = {};
            text.split('\n').forEach(line => {
                const match = line.match(/(.+):\s*([+-]?\d+)/);
                if (match) events[match[1].trim()] = parseInt(match[2]);
            });
            return events;
        }

        function saveGoal() {
            const title = document.getElementById('goalTitle').value.trim();
            if (!title) {
                alert('Please enter a goal title');
                return;
            }

            const config = {
                type: selectedType,
                deadline: document.getElementById('goalDeadline').value || null
            };

            if (selectedType === 'recurring') {
                config.interval = document.getElementById('recurringInterval').value;
                config.timesPerInterval = parseInt(document.getElementById('recurringTimes').value);
                config.requiredPercent = parseInt(document.getElementById('recurringRequired').value);
            }

            if (selectedType === 'distance') {
                config.distanceStart = parseInt(document.getElementById('distanceStart').value);
                config.wins = document.getElementById('distanceWins').value;
                config.losses = document.getElementById('distanceLosses').value;
            }

            if (selectedType === 'stage') {
                config.stages = document.getElementById('stageNames').value;
                config.currentStage = parseInt(document.getElementById('stageCurrent').value);
            }

            addGoal(title, currentParentId, config);
            closeModal();
        }

        function addGoal(title, parentId = null, config = {}) {
            const goal = createGoal(title, parentId, config);
            
            if (parentId === null) {
                goals.push(goal);
            } else {
                const parent = findGoal(goals, parentId);
                if (parent) {
                    parent.children = parent.children || [];
                    parent.children.push(goal);
                    parent.expanded = true;
                }
            }
            
            saveData();
            renderGoals();
            updateStats();
        }

        // Goal Operations
        function findGoal(goalList, id) {
            for (const goal of goalList) {
                if (goal.id === id) return goal;
                if (goal.children?.length > 0) {
                    const found = findGoal(goal.children, id);
                    if (found) return found;
                }
            }
            return null;
        }

        function deleteGoal(id) {
            if (!confirm('Delete this goal and all sub-goals?')) return;
            goals = removeFromTree(goals, id);
            saveData();
            renderGoals();
            updateStats();
        }

        function removeFromTree(goalList, id) {
            return goalList.filter(g => {
                if (g.id === id) return false;
                if (g.children) g.children = removeFromTree(g.children, id);
                return true;
            });
        }

        function toggleExpand(id) {
            const goal = findGoal(goals, id);
            if (goal) {
                goal.expanded = !goal.expanded;
                saveData();
                renderGoals();
            }
        }

        function toggleComplete(id) {
            const goal = findGoal(goals, id);
            if (goal && goal.type === 'progress') {
                goal.completed = !goal.completed;
                saveData();
                renderGoals();
                updateStats();
            }
        }

        function updateGoalTitle(id, newTitle) {
            const goal = findGoal(goals, id);
            if (goal) {
                goal.title = newTitle;
                saveData();
            }
        }

        // Type-specific actions
        function doRecurring(id, done = true) {
            const goal = findGoal(goals, id);
            if (!goal || goal.type !== 'recurring') return;

            const today = new Date().toISOString().split('T')[0];
            const existing = goal.recurring.completions.find(c => c.date === today);
            
            if (existing) {
                existing.done = done;
            } else {
                goal.recurring.completions.push({date: today, done});
            }

            goal.recurring.streak = calculateStreak(goal.recurring.completions);
            if (goal.recurring.streak > goal.recurring.bestStreak) {
                goal.recurring.bestStreak = goal.recurring.streak;
            }

            goal.health = calculateRecurringHealth(goal.recurring);
            saveData();
            renderGoals();
            updateStats();
        }

        function calculateStreak(completions) {
            let streak = 0;
            const sorted = [...completions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            for (const c of sorted) {
                if (c.done) streak++;
                else break;
            }
            return streak;
        }

        function calculateRecurringHealth(recurring) {
            const recent = recurring.completions.slice(-14);
            if (recent.length === 0) return 100;
            
            const done = recent.filter(c => c.done).length;
            const rate = (done / recent.length) * 100;
            return Math.round((rate / recurring.requiredPercent) * 100);
        }

        function moveDistance(id, amount, reason) {
            const goal = findGoal(goals, id);
            if (!goal || goal.type !== 'distance') return;

            const oldValue = goal.distance.current;
            goal.distance.current = Math.max(0, Math.min(100, goal.distance.current + amount));
            
            goal.distance.history.push({
                date: new Date().toISOString(),
                from: oldValue,
                to: goal.distance.current,
                change: amount,
                reason: reason
            });

            goal.completed = goal.distance.current >= 100;
            saveData();
            renderGoals();
            updateStats();
        }

        function advanceStage(id) {
            const goal = findGoal(goals, id);
            if (!goal || goal.type !== 'stage') return;

            const oldIndex = goal.stage.currentIndex;
            if (oldIndex < goal.stage.stages.length - 1) {
                goal.stage.currentIndex++;
                goal.stage.history.push({
                    date: new Date().toISOString(),
                    from: oldIndex,
                    to: goal.stage.currentIndex
                });
            }

            goal.completed = goal.stage.currentIndex === goal.stage.stages.length - 1;
            saveData();
            renderGoals();
            updateStats();
        }

        function regressStage(id) {
            const goal = findGoal(goals, id);
            if (!goal || goal.type !== 'stage') return;

            const oldIndex = goal.stage.currentIndex;
            if (oldIndex > 0) {
                goal.stage.currentIndex--;
                goal.stage.history.push({
                    date: new Date().toISOString(),
                    from: oldIndex,
                    to: goal.stage.currentIndex,
                    regression: true
                });
            }

            saveData();
            renderGoals();
            updateStats();
        }

        // Calculations
        function calculateProgress(goal) {
            if (goal.type === 'stage') {
                return goal.stage.stages.length > 1 
                    ? Math.round((goal.stage.currentIndex / (goal.stage.stages.length - 1)) * 100)
                    : 100;
            }
            if (goal.type === 'distance') {
                return goal.distance.current;
            }
            if (goal.type === 'recurring') {
                return Math.min(100, Math.max(0, goal.health));
            }
            if (!goal.children?.length) return goal.completed ? 100 : 0;
            
            let total = 0;
            for (const child of goal.children) {
                total += calculateProgress(child);
            }
            return Math.round(total / goal.children.length);
        }

        function calculateHealth(goal) {
            if (goal.type === 'recurring') return goal.health || 100;
            if (goal.type === 'distance') {
                const recent = goal.distance.history.slice(-3);
                const avgChange = recent.length > 0 
                    ? recent.reduce((a, h) => a + (h.change || 0), 0) / recent.length 
                    : 0;
                return Math.max(30, Math.min(100, 50 + avgChange * 2));
            }
            if (goal.type === 'stage') {
                const progress = calculateProgress(goal);
                const velocity = goal.stage.history.length > 1 ? 10 : 0;
                return Math.min(100, Math.round(progress * 0.8 + 20 + velocity));
            }
            const childHealth = goal.children?.length 
                ? goal.children.reduce((a, c) => a + calculateHealth(c), 0) / goal.children.length 
                : 100;
            const progress = calculateProgress(goal);
            return Math.round(progress * 0.7 + childHealth * 0.3);
        }

        // Rendering
        function escapeHtml(text) {
            if (typeof text !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDeadline(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const today = new Date();
            today.setHours(0,0,0,0);
            const deadline = new Date(dateStr);
            deadline.setHours(0,0,0,0);
            
            const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
            
            let className = '';
            let icon = '◷';
            if (diffDays < 0) {
                className = 'urgent';
                icon = '!';
            } else if (diffDays <= 3) {
                className = 'warning';
                icon = '◷';
            }
            
            const dateText = date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'});
            return `<span class="deadline-badge ${className}">${icon} ${dateText}${diffDays < 0 ? ' (overdue)' : diffDays <= 3 && diffDays >= 0 ? ` (${diffDays}d)` : ''}</span>`;
        }

        function renderGoals() {
            const container = document.getElementById('goalTree');
            
            let filteredGoals = goals;
            if (currentFilter === 'active') filteredGoals = goals.filter(g => !g.completed);
            if (currentFilter === 'completed') filteredGoals = goals.filter(g => g.completed);
            
            if (filteredGoals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">◈</div>
                        <div class="empty-title">No goals found</div>
                        <p class="empty-text">${currentFilter === 'all' ? 'Create your first goal to get started.' : 'No goals match the current filter.'}</p>
                    </div>`;
                return;
            }

            container.innerHTML = filteredGoals.map(g => renderGoalCard(g, 0)).join('');
        }

        function renderGoalCard(goal, level) {
            const hasChildren = goal.children?.length > 0;
            const health = calculateHealth(goal);
            const healthClass = health > 70 ? 'health-high' : health > 40 ? 'health-medium' : 'health-low';
            const progress = calculateProgress(goal);
            const isComplete = goal.completed || progress === 100;

            const typeBadge = {
                progress: '<span class="goal-type-badge badge-progress">Progress</span>',
                recurring: '<span class="goal-type-badge badge-recurring">Recurring</span>',
                distance: '<span class="goal-type-badge badge-distance">Distance</span>',
                stage: '<span class="goal-type-badge badge-stage">Stages</span>'
            }[goal.type] || '';

            let specialUI = '';

            // Recurring UI
            if (goal.type === 'recurring') {
                const recent = goal.recurring.completions.slice(-7);
                const today = new Date().toISOString().split('T')[0];
                const doneToday = recent.find(c => c.date === today)?.done;
                
                specialUI = `
                    <div class="streak-badge">
                        <span class="streak-icon">${goal.recurring.streak > 5 ? '🔥' : goal.recurring.streak > 2 ? '⚡' : '•'}</span>
                        <span>${goal.recurring.streak} streak</span>
                    </div>
                    <button class="action-btn primary" onclick="doRecurring(${goal.id}, ${!doneToday})" title="${doneToday ? 'Undo today' : 'Mark done'}">
                        ${doneToday ? '↩' : '✓'}
                    </button>
                `;
            }

            // Distance UI
            if (goal.type === 'distance') {
                const dist = goal.distance.current;
                const color = dist > 70 ? 'var(--success)' : dist > 40 ? 'var(--warning)' : 'var(--danger)';
                
                const winEvents = Object.entries(goal.distance.winEvents || {});
                const lossEvents = Object.entries(goal.distance.lossEvents || {});
                
                specialUI = `
                    <div class="distance-meter">
                        <div class="distance-track">
                            <div class="distance-fill" style="width: ${dist}%; background: ${color}"></div>
                        </div>
                        <span class="distance-value" style="color: ${color}">${dist}%</span>
                    </div>
                    <div class="distance-actions">
                        ${winEvents.map(([name, val]) => {
                            const safeName = escapeHtml(name);
                            return `<button class="distance-btn positive" onclick="moveDistance(${goal.id}, ${val}, '${safeName.replace(/'/g, "\\'")}')">+${val}% ${safeName}</button>`;
                        }).join('')}
                        ${lossEvents.map(([name, val]) => {
                            const safeName = escapeHtml(name);
                            return `<button class="distance-btn negative" onclick="moveDistance(${goal.id}, ${val}, '${safeName.replace(/'/g, "\\'")}')">${val}% ${safeName}</button>`;
                        }).join('')}
                    </div>
                `;
            }

            // Stage UI
            if (goal.type === 'stage') {
                const stages = goal.stage.stages;
                const current = goal.stage.currentIndex;
                
                specialUI = `
                    <div class="stage-pipeline">
                        ${stages.map((s, i) => `
                            <span class="stage-pill ${i === current ? 'active' : i < current ? 'completed' : ''}">${escapeHtml(s)}</span>
                            ${i < stages.length - 1 ? '<span class="stage-arrow">→</span>' : ''}
                        `).join('')}
                    </div>
                    <div class="goal-actions">
                        <button class="action-btn success" onclick="advanceStage(${goal.id})" title="Next stage">→</button>
                        <button class="action-btn" onclick="regressStage(${goal.id})" title="Previous stage">←</button>
                    </div>
                `;
            }

            // Progress UI (default)
            if (goal.type === 'progress') {
                specialUI = `
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill ${isComplete ? 'completed' : ''}" style="width: ${progress}%"></div>
                        </div>
                        <span class="progress-text">${progress}%</span>
                    </div>
                `;
            }

            return `
                <div class="goal-card" data-level="${Math.min(level, 3)}" data-id="${goal.id}">
                    <div class="goal-header">
                        <button class="goal-expand ${goal.expanded ? 'expanded' : ''} ${hasChildren ? '' : 'hidden'}" 
                                onclick="${hasChildren ? `toggleExpand(${goal.id})` : ''}">
                            ▶
                        </button>
                        
                        ${goal.type === 'progress' ? `
                            <div class="goal-checkbox ${goal.completed ? 'completed' : ''}" onclick="toggleComplete(${goal.id})"></div>
                        ` : '<div style="width:20px"></div>'}
                        
                        ${typeBadge}
                        
                        <input type="text" 
                               class="goal-title-input ${goal.completed ? 'completed' : ''}"
                               value="${escapeHtml(goal.title)}" 
                               onchange="updateGoalTitle(${goal.id}, this.value)"
                               placeholder="Goal title">
                        
                        <div class="goal-meta">
                            ${specialUI}
                            ${goal.deadline ? formatDeadline(goal.deadline) : ''}
                            <div class="health-indicator ${healthClass}">
                                <span>${health > 80 ? '●' : health > 50 ? '◐' : '○'}</span>
                                <span>${Math.round(health)}%</span>
                            </div>
                        </div>
                        
                        <div class="goal-actions">
                            <button class="action-btn primary" onclick="openModal(${goal.id})" title="Add sub-goal">+</button>
                            <button class="action-btn danger" onclick="deleteGoal(${goal.id})" title="Delete">×</button>
                        </div>
                    </div>
                    
                    ${hasChildren ? `
                        <div class="children-container">
                            <div class="children-wrapper ${goal.expanded ? 'expanded' : ''}">
                                ${goal.children.map(child => renderGoalCard(child, level + 1)).join('')}
                                <button class="add-sub-goal" onclick="openModal(${goal.id})">
                                    <span>+</span> Add Sub-goal
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Stats & Filtering
        function filterGoals(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.toggle('active', tab.textContent.toLowerCase().includes(filter) || 
                    (filter === 'all' && tab.textContent === 'All'));
            });
            renderGoals();
        }

        function flattenGoals(goalList) {
            let result = [];
            for (const g of goalList) {
                result.push(g);
                if (g.children?.length) {
                    result = result.concat(flattenGoals(g.children));
                }
            }
            return result;
        }

        function updateStats() {
            const allGoals = flattenGoals(goals);
            const completed = allGoals.filter(g => g.completed).length;
            const total = allGoals.length;
            const healths = allGoals.map(g => calculateHealth(g));
            const avgHealth = healths.length > 0 ? Math.round(healths.reduce((a,b) => a+b, 0) / healths.length) : 0;
            
            const activeStreaks = allGoals.filter(g => g.type === 'recurring' && g.recurring?.streak > 0).length;
            
            const today = new Date();
            const soon = new Date();
            soon.setDate(soon.getDate() + 7);
            const dueSoon = allGoals.filter(g => {
                if (!g.deadline || g.completed) return false;
                const d = new Date(g.deadline);
                return d <= soon && d >= today;
            }).length;

            document.getElementById('totalGoals').textContent = total;
            document.getElementById('completedGoals').textContent = completed;
            document.getElementById('avgHealth').textContent = avgHealth + '%';
            document.getElementById('activeStreaks').textContent = activeStreaks;
            document.getElementById('dueSoon').textContent = dueSoon;
        }

        // Import/Export
        function exportData() {
            const data = JSON.stringify(goals, null, 2);
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `goals-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (!Array.isArray(imported)) throw new Error('Invalid format');
                        if (confirm(`Import ${imported.length} goals? This will replace current data.`)) {
                            goals = imported;
                            nextId = Math.max(0, ...goals.map(g => g.id)) + 1;
                            saveData();
                            renderGoals();
                            updateStats();
                        }
                    } catch (err) {
                        alert('Import failed: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
            if (e.key === 'n' && e.ctrlKey) {
                e.preventDefault();
                openModal();
            }
        });
    </script>
</body>
</html>
